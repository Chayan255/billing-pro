generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  STAFF
  CASHIER
}

enum PaymentMethod {
  CASH
  UPI
  CARD
}

enum DiscountType {
  FLAT
  PERCENT
}

enum GstType {
  CGST_SGST
  IGST
}

/* =======================
   USER
======================= */
model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  role      Role
  createdAt DateTime @default(now())
}

/* =======================
   CUSTOMER
======================= */
model Customer {
  id        Int      @id @default(autoincrement())
  name      String
  phone     String?
  gstin     String?
  createdAt DateTime @default(now())

  bills Bill[]
}

/* =======================
   PRODUCT
======================= */
model Product {
  id        Int      @id @default(autoincrement())
  name      String
  sku       String   @unique
  price     Float
  stock     Int
  category  String
  createdAt DateTime @default(now())

  billItems BillItem[]
  cartItems CartItem[]
}

/* =======================
   BILL (PROFESSIONAL GST)
======================= */
model Bill {
  id Int @id @default(autoincrement())

  /* Customer */
  customerName   String?
  customerMobile String?
  customerId     Int?
  customer       Customer? @relation(fields: [customerId], references: [id])

  /* Company snapshot */
  companyName    String   @default("Billing Pro")
  companyGstin   String?
  companyAddress String?

  /* GST */
  gstType     GstType
  gstPercent  Float
  taxableAmount Float
  cgst        Float
  sgst        Float
  igst        Float

  /* Discounts & Total */
  totalDiscount Float
  roundOff      Float
  totalAmount   Float

  /* Payment */
  paymentMethod PaymentMethod

  notes String?

  createdAt DateTime @default(now())

  items BillItem[]
}

/* =======================
   BILL ITEM
======================= */
model BillItem {
  id        Int @id @default(autoincrement())
  billId    Int
  productId Int

  quantity  Int
  price     Float

  discount     Float
  discountType DiscountType
  gstPercent   Float
  lineTotal    Float

  bill    Bill    @relation(fields: [billId], references: [id])
  product Product @relation(fields: [productId], references: [id])
}

/* =======================
   CART ITEM
======================= */
model CartItem {
  id        Int @id @default(autoincrement())
  userId    Int
  productId Int

  quantity  Int
  price     Float

  discount     Float
  discountType DiscountType
  gstPercent   Float

  createdAt DateTime @default(now())

  product Product @relation(fields: [productId], references: [id])
}
